<!-- OPRAVA: ImprovedAdvancedDataGridControl.xaml - Všetky XAML chyby opravené -->
<!-- SÚBOR: RpaWinUiComponents/AdvancedWinUiDataGrid/Views/ImprovedAdvancedDataGridControl.xaml -->

<UserControl
    x:Class="RpaWinUiComponents.AdvancedWinUiDataGrid.Views.ImprovedAdvancedDataGridControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:RpaWinUiComponents.AdvancedWinUiDataGrid.Controls"
    xmlns:converters="using:RpaWinUiComponents.AdvancedWinUiDataGrid.Converters"
    mc:Ignorable="d"
    Background="White">

    <UserControl.Resources>
        <!-- Converters -->
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:ValidationErrorToBrushConverter x:Key="ValidationErrorToBrushConverter"/>
        <converters:AlternatingRowBackgroundConverter x:Key="AlternatingRowBackgroundConverter"/>

        <!-- Performance - Virtualized ItemsRepeater Layout -->
        <UniformGridLayout x:Key="HeaderLayout" 
                           Orientation="Horizontal" 
                           MinItemWidth="80" 
                           MinItemHeight="40"/>

        <StackLayout x:Key="RowsLayout" 
                     Orientation="Vertical" 
                     Spacing="1"/>

        <!-- OPRAVA XLS0414: Použiť existujúci typ namiesto neexistujúceho ColumnDefinitionViewModel -->
        <DataTemplate x:Key="HeaderTemplate">
            <Border Background="#F8F9FA" 
                    BorderBrush="#DEE2E6" 
                    BorderThickness="0,0,1,1"
                    MinWidth="80"
                    Width="120"
                    MaxWidth="300"
                    Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="{Binding Header}"
                               FontWeight="SemiBold"
                               FontSize="12"
                               Foreground="#495057"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"/>

                    <!-- OPRAVA XLS0413: Odstrániť neplatné Cursor property z Border -->
                    <Border Grid.Column="1" 
                            Width="4" 
                            Background="Transparent"
                            Visibility="Visible">
                        <Rectangle Fill="#CCCCCC" Width="1" VerticalAlignment="Stretch"/>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- OPRAVA: Použiť existujúce typy namiesto neexistujúcich ViewModels -->
        <DataTemplate x:Key="RowTemplate">
            <Border Background="White"
                    BorderBrush="#DEE2E6"
                    BorderThickness="1,0,1,1">

                <!-- Placeholder pre row content - bude naplnené programovo -->
                <StackPanel Orientation="Horizontal" x:Name="RowCellsPanel"/>
            </Border>
        </DataTemplate>

        <!-- Error Display Template -->
        <DataTemplate x:Key="ErrorTemplate">
            <Border Background="#FFF3CD" 
                    BorderBrush="#FFEAA7" 
                    BorderThickness="1" 
                    CornerRadius="4" 
                    Padding="16"
                    Margin="8">
                <StackPanel Spacing="8">
                    <TextBlock Text="⚠️ Error Loading Data" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="#856404"/>
                    <TextBlock x:Name="ErrorMessageText"
                               FontSize="12" 
                               Foreground="#856404"
                               TextWrapping="Wrap"/>
                    <Button Content="Retry" 
                            Background="#17A2B8" 
                            Foreground="White"
                            Click="OnRetryClick"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
            <RowDefinition Height="Auto"/>
            <!-- Headers -->
            <RowDefinition Height="*"/>
            <!-- Data -->
            <RowDefinition Height="Auto"/>
            <!-- Progress -->
            <RowDefinition Height="Auto"/>
            <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- Status Bar -->
        <Border Grid.Row="0" 
                Background="#F8F9FA" 
                BorderBrush="#DEE2E6" 
                BorderThickness="0,0,0,1" 
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                    <TextBlock Text="📊 Advanced DataGrid" 
                               FontSize="14" 
                               FontWeight="Bold" 
                               Foreground="#1976D2" 
                               VerticalAlignment="Center"/>
                    <TextBlock x:Name="StatusText" 
                               Text="Ready" 
                               FontSize="12" 
                               Foreground="#666" 
                               VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button x:Name="CopyButton" 
                            Content="📋 Copy" 
                            FontSize="10" 
                            Padding="8,4"
                            Click="OnCopyClick"/>
                    <Button x:Name="PasteButton" 
                            Content="📥 Paste" 
                            FontSize="10" 
                            Padding="8,4"
                            Click="OnPasteClick"/>
                    <Button x:Name="ValidateButton" 
                            Content="✅ Validate" 
                            FontSize="10" 
                            Padding="8,4"
                            Click="OnValidateClick"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Headers -->
        <Border Grid.Row="1" 
                Background="#F8F9FA" 
                BorderBrush="#DEE2E6" 
                BorderThickness="1,0,1,1">
            <ScrollViewer x:Name="HeaderScrollViewer"
                          HorizontalScrollMode="Auto"
                          VerticalScrollMode="Disabled"
                          HorizontalScrollBarVisibility="Hidden"
                          VerticalScrollBarVisibility="Disabled"
                          ZoomMode="Disabled">
                <!-- OPRAVA: Používať StackPanel namiesto ItemsRepeater pre jednoduchšiu implementáciu -->
                <StackPanel x:Name="HeaderPanel" 
                           Orientation="Horizontal" 
                           Background="#F8F9FA"
                           MinHeight="40"/>
            </ScrollViewer>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <!-- Loading State -->
            <StackPanel x:Name="LoadingPanel" 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center"
                       Visibility="Visible"
                       Spacing="16">
                <ProgressRing Width="48" Height="48" IsActive="True"/>
                <TextBlock Text="Initializing DataGrid..." 
                          FontSize="16" 
                          Foreground="#666"
                          HorizontalAlignment="Center"/>
                <TextBlock x:Name="LoadingDetailText"
                          Text="Preparing components..."
                          FontSize="12" 
                          Foreground="#999"
                          HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- Data Display -->
            <ScrollViewer x:Name="DataScrollViewer"
                          Visibility="Collapsed"
                          HorizontalScrollMode="Auto"
                          VerticalScrollMode="Auto"
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto"
                          ZoomMode="Disabled"
                          ViewChanged="OnScrollViewChanged">
                <!-- OPRAVA: Používať StackPanel namiesto ItemsRepeater pre jednoduchšiu implementáciu -->
                <StackPanel x:Name="DataRowsPanel" 
                           Orientation="Vertical"
                           Background="White"/>
            </ScrollViewer>

            <!-- Empty State -->
            <StackPanel x:Name="EmptyStatePanel"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Visibility="Collapsed"
                       Spacing="16">
                <TextBlock Text="📄 No Data" 
                          FontSize="20" 
                          FontWeight="Bold" 
                          Foreground="#999"
                          HorizontalAlignment="Center"/>
                <TextBlock Text="Use LoadDataAsync() to load data" 
                          FontSize="14" 
                          Foreground="#BBB"
                          HorizontalAlignment="Center"/>
                <Button Content="Load Sample Data" 
                        Background="#17A2B8" 
                        Foreground="White"
                        Padding="16,8"
                        Click="OnLoadSampleDataClick"/>
            </StackPanel>

            <!-- Error State -->
            <ContentPresenter x:Name="ErrorPresenter"
                              ContentTemplate="{StaticResource ErrorTemplate}"
                              Visibility="Collapsed"/>
        </Grid>

        <!-- Progress Bar -->
        <Border Grid.Row="3" 
                x:Name="ProgressPanel"
                Background="#F5F5F5" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,1,0,0" 
                Padding="12,8"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Spacing="4">
                    <TextBlock x:Name="ProgressText" 
                              Text="Processing..." 
                              FontSize="12" 
                              Foreground="#333"/>
                    <ProgressBar x:Name="ProgressBar" 
                                Height="4" 
                                Minimum="0" 
                                Maximum="100" 
                                Value="0"/>
                </StackPanel>

                <Button Grid.Column="1" 
                        x:Name="CancelButton"
                        Content="Cancel" 
                        FontSize="10" 
                        Padding="8,4"
                        Click="OnCancelClick"/>
            </Grid>
        </Border>

        <!-- Footer Status -->
        <Border Grid.Row="4" 
                Background="#F5F5F5" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,1,0,0" 
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                    <TextBlock x:Name="RowCountText" 
                              Text="0 rows" 
                              FontSize="11" 
                              Foreground="#666"/>
                    <TextBlock x:Name="ValidationText" 
                              Text="" 
                              FontSize="11" 
                              Foreground="Red"/>
                    <TextBlock x:Name="MemoryText"
                              Text=""
                              FontSize="11"
                              Foreground="#999"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="F2: Edit | Enter: Next | Tab: Navigate | Ctrl+C/V: Copy/Paste" 
                              FontSize="10" 
                              Foreground="#999" 
                              VerticalAlignment="Center"/>
                    <Button x:Name="HelpButton" 
                            Content="?" 
                            Width="20" 
                            Height="20"
                            FontSize="10"
                            Click="OnHelpClick"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>