<?xml version="1.0" encoding="utf-8"?>
<!-- build/RpaWinUiComponents.targets - MINIMÃLNA MSB3030 OPRAVA -->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <RpaWinUiComponentsVersion Condition="'$(RpaWinUiComponentsVersion)' == ''">1.0.14</RpaWinUiComponentsVersion>
  </PropertyGroup>

  <!-- âœ… ZÃKLADNÃ KONTROLA: Nie sme v samom RpaWinUiComponents projekte -->
  <PropertyGroup>
    <_IsRpaWinUiComponentsProject Condition="'$(AssemblyName)' == 'RpaWinUiComponents' OR '$(MSBuildProjectName)' == 'RpaWinUiComponents'">true</_IsRpaWinUiComponentsProject>
    <_IsRpaWinUiComponentsProject Condition="'$(_IsRpaWinUiComponentsProject)' == ''">false</_IsRpaWinUiComponentsProject>
  </PropertyGroup>

  <!-- âœ… ROZÅ ÃRENÃ OPRAVA: Suppress vÅ¡etky XBF related warnings/errors -->
  <PropertyGroup>
    <!-- Suppress MSB3030 (file not found) pre XBF sÃºbory -->
    <MSBuildWarningsAsMessages>$(MSBuildWarningsAsMessages);MSB3030</MSBuildWarningsAsMessages>
    <NoWarn>$(NoWarn);MSB3030;MSB3277;MSB3026;MSB3061</NoWarn>

    <!-- DodatoÄnÃ© MSBuild nastavenia pre XBF potlaÄenie -->
    <ErrorOnDuplicateItems>false</ErrorOnDuplicateItems>
    <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
  </PropertyGroup>

  <!-- âœ… KÄ½ÃšÄŒOVÃ OPRAVA MSB3030: Ãšplne potlaÄ XBF operÃ¡cie -->
  <Target Name="ExcludeXbfFiles" BeforeTargets="ResolveAssemblyReferences;CopyFilesToOutputDirectory;GetCopyToOutputDirectoryItems;GetTargetPath" Condition="'$(_IsRpaWinUiComponentsProject)' == 'false'">
    <ItemGroup>
      <!-- OdstrÃ¡Åˆ vÅ¡etky XBF sÃºbory zo vÅ¡etkÃ½ch moÅ¾nÃ½ch lokÃ¡ciÃ­ -->
      <ContentWithTargetPath Remove="**/*.xbf" />
      <ReferenceCopyLocalPaths Remove="**/*.xbf" />
      <FilesToCopy Remove="**/*.xbf" />
      <Content Remove="**/*.xbf" />
      <None Remove="**/*.xbf" />
      <EmbeddedResource Remove="**/*.xbf" />
      <Resource Remove="**/*.xbf" />

      <!-- Å pecificky pre RpaWinUiComponents -->
      <ReferenceCopyLocalPaths Remove="**\RpaWinUiComponents\**\*.xbf" />
      <ContentWithTargetPath Remove="**\RpaWinUiComponents\**\*.xbf" />
      <FilesToCopy Remove="**\RpaWinUiComponents\**\*.xbf" />

      <!-- OdstrÃ¡Åˆ z package assets -->
      <_ResolvedCopyLocalBuildProjectReferences Remove="**\*.xbf" />
      <RuntimeCopyLocalItems Remove="**\*.xbf" />
    </ItemGroup>

    <Message Text="ðŸš« RpaWinUiComponents: VÅ¡etky XBF operÃ¡cie potlaÄenÃ© (MSB3030 fix)" Importance="low" />
  </Target>

  <!-- âœ… DODATOÄŒNÃ OCHRANA: PotlaÄ XBF z package resolving -->
  <Target Name="RemoveXbfFromPackages" AfterTargets="ResolvePackageAssets" BeforeTargets="ResolveAssemblyReferences">
    <ItemGroup>
      <ReferenceCopyLocalPaths Remove="@(ReferenceCopyLocalPaths)" Condition="'%(ReferenceCopyLocalPaths.Extension)' == '.xbf'" />
      <RuntimeCopyLocalItems Remove="@(RuntimeCopyLocalItems)" Condition="'%(RuntimeCopyLocalItems.Extension)' == '.xbf'" />
      <ContentWithTargetPath Remove="@(ContentWithTargetPath)" Condition="'%(ContentWithTargetPath.Extension)' == '.xbf'" />
    </ItemGroup>
  </Target>

  <!-- âœ… ZACHOVANÃ‰: WinUI dependencies -->
  <ItemGroup Condition="'$(UseWinUI)' == 'true'">
    <PackageReference Include="Microsoft.WindowsAppSDK" Version="1.7.250606001" Condition="'@(PackageReference->WithMetadataValue('Identity', 'Microsoft.WindowsAppSDK'))' == ''" />
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="9.0.6" Condition="'@(PackageReference->WithMetadataValue('Identity', 'Microsoft.Extensions.DependencyInjection'))' == ''" />
    <PackageReference Include="Microsoft.Extensions.Hosting" Version="9.0.6" Condition="'@(PackageReference->WithMetadataValue('Identity', 'Microsoft.Extensions.Hosting'))' == ''" />
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="9.0.6" Condition="'@(PackageReference->WithMetadataValue('Identity', 'Microsoft.Extensions.Logging.Abstractions'))' == ''" />
  </ItemGroup>

  <!-- âœ… ZACHOVANÃ‰: Info message -->
  <Target Name="RpaWinUiComponentsInfo" BeforeTargets="Build" Condition="'$(_IsRpaWinUiComponentsProject)' == 'false'">
    <Message Text="ðŸ“¦ RpaWinUiComponents v$(RpaWinUiComponentsVersion) (MSB3030 XBF fix applied)" Importance="normal" />
  </Target>

</Project>